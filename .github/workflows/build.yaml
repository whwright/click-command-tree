name: build and test

on: [push]

jobs:
  build:

    runs-on: ubuntu-latest
    strategy:
      matrix:

        # GOALS
        # 5.0 - 2.7, 3.x
        # 6.0 - 2.7, 3.x
        # 7.0 - 2.7, 3.4+
        # 8.0 - 3.6+
        # 8.1 - 3.7+
        python-version: [
          # "3.6",  # TODO: Error: The version '3.6' with architecture 'x64' was not found for Ubuntu 22.04.
          "3.7",
          "3.8",
          "3.9",
          "3.10",
          "3.11"
        ]
        click-version: [
          # "5.0",
          # "5.1",
          # "6.0",
          "7.0",
          "7.1.2",
          "8.0.4",
          "8.1.3",
        ]
        include:
          - python-version: "2.x"
            click-version: "7.1.2"
        exclude:
          # click 8.1 drops support for py36
          - python-version: "3.6"
            click-version: "8.1.4"


    steps:
      - uses: actions/checkout@v3
      - name: Set up Python ${{ matrix.python-version }}
        uses: actions/setup-python@v4
        with:
          python-version: ${{ matrix.python-version }}
      - name: Install package
        run: |
          python -m pip install --upgrade pip
          pip install click==${{ matrix.click-version }}
          python setup.py install
      - name: Verify click version
        run: pip freeze click
      - name: Run tests
        run: python -m unittest discover -v
